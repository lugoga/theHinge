labs(subtitle = wind.series[[31]]$time %>% unique())
dec = wind.series[[31]] %>% as_tibble() %>%
ggplot(aes(x = lon, y = lat))+
metR::geom_contour_fill(aes(z = speed))+
# metR::geom_contour2(aes(z = speed), breaks = seq(4,20,4))+
metR::geom_vector(aes(dx = ugrd10m, dy = vgrd10m), skip = 1, show.legend = FALSE,
preserve.dir = TRUE, arrow.type = "open", arrow.angle = 20)+
scale_fill_gradientn(colours = mycolor3,
limits = c(0,15),
breaks = scales::breaks_pretty(n = 10),
guide = guide_colorbar(title = expression(Wind~speed~(ms^{-1})),
title.position = "right",
title.theme = element_text(angle = 90),
title.hjust = .5,
barwidth = unit(.4,"cm"),
barheight = unit(6,"cm")))+
ggspatial::layer_spatial(data = wio)+
ggspatial::stat_spatial_identity(data = wio, aes(label = name_long), geom = "label_repel")+
# geom_sf_text(data = wio, aes(label = name_long))+
coord_sf(xlim = c(34,55), ylim = c(-23,4))+
metR::scale_mag(max = 15)+
theme_bw()+
theme(axis.title = element_blank(), axis.text.y = element_blank())+
labs(subtitle = wind.series[[31]]$time %>% unique())
dec = wind.series[[31]] %>% as_tibble() %>%
ggplot(aes(x = lon, y = lat))+
metR::geom_contour_fill(aes(z = speed))+
# metR::geom_contour2(aes(z = speed), breaks = seq(4,20,4))+
metR::geom_vector(aes(dx = ugrd10m, dy = vgrd10m), skip = 1, show.legend = FALSE,
preserve.dir = TRUE, arrow.type = "open", arrow.angle = 20)+
scale_fill_gradientn(colours = mycolor3,
limits = c(0,15),
breaks = scales::breaks_pretty(n = 10),
guide = guide_colorbar(title = expression(Wind~speed~(ms^{-1})),
title.position = "right",
title.theme = element_text(angle = 90),
title.hjust = .5,
barwidth = unit(.4,"cm"),
barheight = unit(6,"cm")))+
ggspatial::layer_spatial(data = wio)+
ggspatial::stat_spatial_identity(data = wio, aes(label = name_long), geom = "ggspatial::label_repel")+
# geom_sf_text(data = wio, aes(label = name_long))+
coord_sf(xlim = c(34,55), ylim = c(-23,4))+
metR::scale_mag(max = 15)+
theme_bw()+
theme(axis.title = element_blank(), axis.text.y = element_blank())+
labs(subtitle = wind.series[[31]]$time %>% unique())
dec = wind.series[[31]] %>% as_tibble() %>%
ggplot(aes(x = lon, y = lat))+
metR::geom_contour_fill(aes(z = speed))+
# metR::geom_contour2(aes(z = speed), breaks = seq(4,20,4))+
metR::geom_vector(aes(dx = ugrd10m, dy = vgrd10m), skip = 1, show.legend = FALSE,
preserve.dir = TRUE, arrow.type = "open", arrow.angle = 20)+
scale_fill_gradientn(colours = mycolor3,
limits = c(0,15),
breaks = scales::breaks_pretty(n = 10),
guide = guide_colorbar(title = expression(Wind~speed~(ms^{-1})),
title.position = "right",
title.theme = element_text(angle = 90),
title.hjust = .5,
barwidth = unit(.4,"cm"),
barheight = unit(6,"cm")))+
ggspatial::layer_spatial(data = wio)+
ggspatial::geom_spatial_label_repel(data = wio, aes(label = name_long))+
# geom_sf_text(data = wio, aes(label = name_long))+
coord_sf(xlim = c(34,55), ylim = c(-23,4))+
metR::scale_mag(max = 15)+
theme_bw()+
theme(axis.title = element_blank(), axis.text.y = element_blank())+
labs(subtitle = wind.series[[31]]$time %>% unique())
aug + dec
wio %>% sf_transform_xy()
wio %>% st_drop_geometry()
wio %>% st_point_on_surface()
dec = wind.series[[31]] %>% as_tibble() %>%
ggplot(aes(x = lon, y = lat))+
metR::geom_contour_fill(aes(z = speed))+
# metR::geom_contour2(aes(z = speed), breaks = seq(4,20,4))+
metR::geom_vector(aes(dx = ugrd10m, dy = vgrd10m), skip = 1, show.legend = FALSE,
preserve.dir = TRUE, arrow.type = "open", arrow.angle = 20)+
scale_fill_gradientn(colours = mycolor3,
limits = c(0,15),
breaks = scales::breaks_pretty(n = 10),
guide = guide_colorbar(title = expression(Wind~speed~(ms^{-1})),
title.position = "right",
title.theme = element_text(angle = 90),
title.hjust = .5,
barwidth = unit(.4,"cm"),
barheight = unit(6,"cm")))+
ggspatial::layer_spatial(data = wio)+
ggspatial::geom_spatial_label_repel(data = wio %>% st_point_on_surface(), aes(label = name_long))+
# geom_sf_text(data = wio, aes(label = name_long))+
coord_sf(xlim = c(34,55), ylim = c(-23,4))+
metR::scale_mag(max = 15)+
theme_bw()+
theme(axis.title = element_blank(), axis.text.y = element_blank())+
labs(subtitle = wind.series[[31]]$time %>% unique())
aug + dec
require(ggspatial)
dec = wind.series[[31]] %>% as_tibble() %>%
ggplot(aes(x = lon, y = lat))+
metR::geom_contour_fill(aes(z = speed))+
# metR::geom_contour2(aes(z = speed), breaks = seq(4,20,4))+
metR::geom_vector(aes(dx = ugrd10m, dy = vgrd10m), skip = 1, show.legend = FALSE,
preserve.dir = TRUE, arrow.type = "open", arrow.angle = 20)+
scale_fill_gradientn(colours = mycolor3,
limits = c(0,15),
breaks = scales::breaks_pretty(n = 10),
guide = guide_colorbar(title = expression(Wind~speed~(ms^{-1})),
title.position = "right",
title.theme = element_text(angle = 90),
title.hjust = .5,
barwidth = unit(.4,"cm"),
barheight = unit(6,"cm")))+
ggspatial::layer_spatial(data = wio)+
ggspatial::stat_spatial_identity(data = wio %>% st_point_on_surface(), aes(label = name_long), geom = "label_repel")+
# geom_sf_text(data = wio, aes(label = name_long))+
coord_sf(xlim = c(34,55), ylim = c(-23,4))+
metR::scale_mag(max = 15)+
theme_bw()+
theme(axis.title = element_blank(), axis.text.y = element_blank())+
labs(subtitle = wind.series[[31]]$time %>% unique())
dec = wind.series[[31]] %>% as_tibble() %>%
ggplot(aes(x = lon, y = lat))+
metR::geom_contour_fill(aes(z = speed))+
# metR::geom_contour2(aes(z = speed), breaks = seq(4,20,4))+
metR::geom_vector(aes(dx = ugrd10m, dy = vgrd10m), skip = 1, show.legend = FALSE,
preserve.dir = TRUE, arrow.type = "open", arrow.angle = 20)+
scale_fill_gradientn(colours = mycolor3,
limits = c(0,15),
breaks = scales::breaks_pretty(n = 10),
guide = guide_colorbar(title = expression(Wind~speed~(ms^{-1})),
title.position = "right",
title.theme = element_text(angle = 90),
title.hjust = .5,
barwidth = unit(.4,"cm"),
barheight = unit(6,"cm")))+
ggspatial::layer_spatial(data = wio)+
ggspatial::stat_spatial_identity(data = wio %>% st_point_on_surface(), aes(label = name_long), geom = "text")+
# geom_sf_text(data = wio, aes(label = name_long))+
coord_sf(xlim = c(34,55), ylim = c(-23,4))+
metR::scale_mag(max = 15)+
theme_bw()+
theme(axis.title = element_blank(), axis.text.y = element_blank())+
labs(subtitle = wind.series[[31]]$time %>% unique())
aug + dec
dec = wind.series[[31]] %>% as_tibble() %>%
ggplot(aes(x = lon, y = lat))+
metR::geom_contour_fill(aes(z = speed))+
# metR::geom_contour2(aes(z = speed), breaks = seq(4,20,4))+
metR::geom_vector(aes(dx = ugrd10m, dy = vgrd10m), skip = 1, show.legend = FALSE,
preserve.dir = TRUE, arrow.type = "open", arrow.angle = 20)+
scale_fill_gradientn(colours = mycolor3,
limits = c(0,15),
breaks = scales::breaks_pretty(n = 10),
guide = guide_colorbar(title = expression(Wind~speed~(ms^{-1})),
title.position = "right",
title.theme = element_text(angle = 90),
title.hjust = .5,
barwidth = unit(.4,"cm"),
barheight = unit(6,"cm")))+
ggspatial::layer_spatial(data = wio)+
ggspatial::stat_spatial_identity(aes(label = name_long), geom = "text")+
# geom_sf_text(data = wio, aes(label = name_long))+
coord_sf(xlim = c(34,55), ylim = c(-23,4))+
metR::scale_mag(max = 15)+
theme_bw()+
theme(axis.title = element_blank(), axis.text.y = element_blank())+
labs(subtitle = wind.series[[31]]$time %>% unique())
aug + dec
dec = wind.series[[31]] %>% as_tibble() %>%
ggplot(aes(x = lon, y = lat))+
metR::geom_contour_fill(aes(z = speed))+
# metR::geom_contour2(aes(z = speed), breaks = seq(4,20,4))+
metR::geom_vector(aes(dx = ugrd10m, dy = vgrd10m), skip = 1, show.legend = FALSE,
preserve.dir = TRUE, arrow.type = "open", arrow.angle = 20)+
scale_fill_gradientn(colours = mycolor3,
limits = c(0,15),
breaks = scales::breaks_pretty(n = 10),
guide = guide_colorbar(title = expression(Wind~speed~(ms^{-1})),
title.position = "right",
title.theme = element_text(angle = 90),
title.hjust = .5,
barwidth = unit(.4,"cm"),
barheight = unit(6,"cm")))+
ggspatial::layer_spatial(data = wio)+
coord_sf(xlim = c(34,55), ylim = c(-23,4))+
metR::scale_mag(max = 15)+
theme_bw()+
theme(axis.title = element_blank(), axis.text.y = element_blank())+
labs(subtitle = wind.series[[31]]$time %>% unique())
aug + dec
citation("rwind")
citation("rWind")
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, warning = FALSE, message = FALSE, comment = "")
getwd()
load("../data/wind.RData")
blogdown::serve_site()
aug + dec
require(shiny)
require(shinydashboard)
require(shinyWidgets)
require(tidyverse)
require(sf)
require(magrittr)
require(patchwork)
blogdown::serve_site()
git status
blogdown:::new_post_addin()
citation("rgeoda")
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, warning = FALSE, message = FALSE, comment = "")
require(rgeoda)
ps = readChar("d:/semba/eez_stock assessment/processed_purse_seine.csv")
require(tidyverse)
require(sf)
require(magrittr)
ps = read_csv("d:/semba/eez_stock assessment/processed_purse_seine.csv")
ps
tuna.cpue.sf = ps %>%
select(category_name, longitude, latitude, wt_mt)%>%
distinct(longitude, latitude, category_name, .keep_all = TRUE)%>%
wior::outlier_remove(wt_mt) %>%
st_as_sf(coords = c("longitude", "latitude"), crs = 4326)
tuna.cpue.sf
yf.sf = tuna.cpue.sf %>%
# filter(category_name == "Yellowfin") %>%
select(-category_name)
yf.getis = yf.sf %>% rgeoda::queen_weights() %>%
local_gstar(df = yf.sf)
labels = yf.getis %>% lisa_labels()
colors = yf.getis %>% lisa_colors()
yf.sf %>%
mutate(clusters = yf.getis %>% lisa_clusters()) %>%
ggplot() +
geom_sf(aes(color = clusters %>% as_factor())) +
ggspatial::layer_spatial(data = tz.sf) +
coord_sf(xlim = c(38.4,43.1), ylim = c(-10.5,-4.8))+
scale_fill_manual(values = cluster.color, label = cluster.label, name = "Getis Ord") +
theme_bw()+
scale_color_manual(values = c("grey80", "red", "blue"), labels = labels, name = "Getis Ord")
yf.sf = tuna.cpue.sf %>%
# filter(category_name == "Yellowfin") %>%
select(-category_name)
yf.getis = yf.sf %>% rgeoda::queen_weights() %>%
local_gstar(df = yf.sf)
labels = yf.getis %>% lisa_labels()
colors = yf.getis %>% lisa_colors()
yf.sf %>%
mutate(clusters = yf.getis %>% lisa_clusters()) %>%
ggplot() +
geom_sf(aes(color = clusters %>% as_factor())) +
# ggspatial::layer_spatial(data = tz.sf) +
coord_sf(xlim = c(38.4,43.1), ylim = c(-10.5,-4.8))+
scale_fill_manual(values = cluster.color, label = cluster.label, name = "Getis Ord") +
theme_bw()+
scale_color_manual(values = c("grey80", "red", "blue"), labels = labels, name = "Getis Ord")
yf.sf %>%
mutate(clusters = yf.getis %>% lisa_clusters()) %>%
ggplot() +
geom_sf(aes(color = clusters %>% as_factor()))
yf.sf %>%
mutate(clusters = yf.getis %>% lisa_clusters()) %>%
ggplot() +
geom_sf(aes(color = clusters %>% as_factor())) +
# ggspatial::layer_spatial(data = tz.sf) +
coord_sf(xlim = c(38.4,43.1), ylim = c(-10.5,-4.8))+
theme_bw()+
scale_color_manual(values = c("grey80", "red", "blue"), labels = labels, name = "Getis Ord")
africa.countries= st_read("d:/semba/pfz/shapefile/africa.shp", quiet = TRUE)%>%
st_simplify(dTolerance = 0.005, preserveTopology = TRUE)
tz.sf = africa.countries %>% st_crop(xmin = 38, ymin = -14, xmax = 43, ymax = -3)
yf.sf %>%
mutate(clusters = yf.getis %>% lisa_clusters()) %>%
ggplot() +
geom_sf(aes(color = clusters %>% as_factor())) +
ggspatial::layer_spatial(data = tz.sf) +
coord_sf(xlim = c(38.4,43.1), ylim = c(-10.5,-4.8))+
theme_bw()+
scale_color_manual(values = c("grey80", "red", "blue"), labels = labels, name = "Getis Ord")
yf.sf %>%
mutate(clusters = yf.getis %>% lisa_clusters()) %>%
ggplot() +
geom_sf(aes(color = clusters %>% as_factor())) +
ggspatial::layer_spatial(data = tz.sf) +
coord_sf(xlim = c(38.4,43.1), ylim = c(-10.5,-4.8))+
theme_bw()+
scale_color_manual(values = c("grey80", "red", "blue"), labels = labels, name = "Getis Ord")
yf.sf
yf.sf %>%
ggplot() +
geom_sf(aes(color = wt_mt)) +
ggspatial::layer_spatial(data = tz.sf) +
coord_sf(xlim = c(38.4,43.1), ylim = c(-10.5,-4.8))+
theme_bw()+
scale_color_gradientn(values = oce::oce.colors9A(120), name = "Getis Ord")
yf.sf %>%
ggplot() +
geom_sf(aes(color = wt_mt)) +
ggspatial::layer_spatial(data = tz.sf) +
coord_sf(xlim = c(38.4,43.1), ylim = c(-10.5,-4.8))+
theme_bw()+
scale_color_gradientn(colors = oce::oce.colors9A(120), name = "Getis Ord")
raw.data = yf.sf %>%
ggplot() +
geom_sf(aes(color = wt_mt)) +
ggspatial::layer_spatial(data = tz.sf) +
coord_sf(xlim = c(38.4,43.1), ylim = c(-10.5,-4.8))+
theme_bw()+
scale_color_gradientn(colors = oce::oce.colors9A(120), name = "Getis Ord")
hot.cold = yf.sf %>%
mutate(clusters = yf.getis %>% lisa_clusters()) %>%
ggplot() +
geom_sf(aes(color = clusters %>% as_factor())) +
ggspatial::layer_spatial(data = tz.sf) +
coord_sf(xlim = c(38.4,43.1), ylim = c(-10.5,-4.8))+
theme_bw()+
scale_color_manual(values = c("grey80", "red", "blue"), labels = labels, name = "Getis Ord")
raw.data + hot.cold
raw.data + hot.cold
raw.data + hot.cold
raw.data = yf.sf %>%
ggplot() +
geom_sf(aes(color = wt_mt)) +
ggspatial::layer_spatial(data = tz.sf) +
coord_sf(xlim = c(38.4,43.1), ylim = c(-10.5,-4.8))+
theme_bw()+
scale_color_gradientn(colors = oce::oce.colors9A(120), name = "Catch (MT)")
raw.data + hot.cold
blogdown::serve_site()
tuna.kernel = ps %>%
st_transform(crs = 32737) %>%
wior::point_tb() %>%
select(-category_name) %>%
rename(x = lon, y = lat) %>%
btb::kernelSmoothing(sEPSG = "32737", iCellSize = 20000, iBandwidth = 30000, vQuantiles = .5) %>%
st_transform(4326)
tuna.kernel = tuna.cpue.sf %>%
st_transform(crs = 32737) %>%
wior::point_tb() %>%
select(-category_name) %>%
rename(x = lon, y = lat) %>%
btb::kernelSmoothing(sEPSG = "32737", iCellSize = 20000, iBandwidth = 30000, vQuantiles = .5) %>%
st_transform(4326)
tuna.kernel = tuna.cpue.sf %>%
st_transform(crs = 32737) %>%
wior::point_tb() %>%
select(-category_name) %>%
rename(x = lon, y = lat) %>%
btb::kernelSmoothing(sEPSG = "32737", iCellSize = 20000, iBandwidth = 30000, vQuantiles = .5) %>%
st_transform(4326)
density.catch = tuna.kernel %>%
ggplot()+
geom_sf(aes(fill = wt_mt_05))+
scale_fill_gradientn(colours = mycolor, trans = scales::boxcox_trans(p = .2))+
ggspatial::layer_spatial(data = tz.sf) +
coord_sf(xlim = c(38.4,43.1), ylim = c(-10.5,-4.8))+
theme_bw()
density.catch = tuna.kernel %>%
ggplot()+
geom_sf(aes(fill = wt_mt_05))+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::boxcox_trans(p = .2))+
ggspatial::layer_spatial(data = tz.sf) +
coord_sf(xlim = c(38.4,43.1), ylim = c(-10.5,-4.8))+
theme_bw()
density.catch
## smooth catch rate
tuna.kernel = tuna.cpue.sf %>%
st_transform(crs = 32737) %>%
wior::point_tb() %>%
select(-category_name) %>%
rename(x = lon, y = lat) %>%
btb::kernelSmoothing(sEPSG = "32737", iCellSize = 20000, iBandwidth = 30000, vQuantiles = .5) %>%
st_transform(4326)
density.catch = tuna.kernel %>%
ggplot()+
geom_sf(aes(fill = wt_mt_05))+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::boxcox_trans(p = .2))+
ggspatial::layer_spatial(data = tz.sf) +
coord_sf(xlim = c(38.4,43.1), ylim = c(-10.5,-4.8))+
theme_bw()
## compute local moran
moran = tuna.kernel %>%
select(wt_mt_05) %>%
rgeoda::queen_weights() %>%
local_gstar(df = tuna.kernel)
hot.cold.catch = tuna.kernel %>%
mutate(clusters = lisa_clusters(moran)) %>%
filter(!clusters >=4) %>%
ggplot() +
geom_sf(aes(fill = clusters %>% as.factor()))+
scale_fill_manual(values = moran %>% lisa_colors(), label = moran %>% lisa_labels(), name = "Clusters")+
ggspatial::layer_spatial(data = tz.sf) +
coord_sf(xlim = c(38.4,43.1), ylim = c(-10.5,-4.8))+
theme_bw()
hot.cold.catch
density.catch + hot.cold.catch
density.catch + hot.cold.catch
## smooth catch rate
tuna.kernel = tuna.cpue.sf %>%
st_transform(crs = 32737) %>%
wior::point_tb() %>%
select(-category_name) %>%
rename(x = lon, y = lat) %>%
btb::kernelSmoothing(sEPSG = "32737", iCellSize = 20000, iBandwidth = 30000, vQuantiles = .5) %>%
st_transform(4326)
density.catch = tuna.kernel %>%
ggplot()+
geom_sf(aes(fill = wt_mt_05))+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::boxcox_trans(p = .2))+
ggspatial::layer_spatial(data = tz.sf) +
coord_sf(xlim = c(38.4,43.1), ylim = c(-10.5,-4.8))+
theme_bw()
## compute local moran
moran = tuna.kernel %>%
select(wt_mt_05) %>%
rgeoda::queen_weights() %>%
local_gstar(df = tuna.kernel)
labels = moran %>% lisa_labels()
colors = moran %>% lisa_colors()
hot.cold.catch = tuna.kernel %>%
mutate(clusters = lisa_clusters(moran)) %>%
filter(!clusters >=4) %>%
ggplot() +
geom_sf(aes(fill = clusters %>% as.factor()))+
scale_fill_manual(values = moran %>% lisa_colors(), label = moran %>% lisa_labels(), name = "Clusters")+
ggspatial::layer_spatial(data = tz.sf) +
coord_sf(xlim = c(38.4,43.1), ylim = c(-10.5,-4.8))+
theme_bw()
density.catch + hot.cold.catch
blogdown:::new_post_addin()
blogdown:::new_post_addin()
blogdown:::new_post_addin()
blogdown::serve_site()
blogdown::check_site()
blogdown::serve_site()
blogdown:::new_post_addin()
knitr::include_graphics(path = "../images/datoga.png")
knitr::include_graphics(path = "../images/hadzabe.png")
knitr::include_graphics(path = "../images/iraqw_kids.png")
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, comment = "")
knitr::include_graphics(path = "../images/hadzabe.png")
blogdown:::update_meta_addin()
blogdown::stop_server()
blogdown::serve_site()
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, comment = "")
knitr::include_graphics("../datoga_cloth.png")
knitr::include_graphics("../images/datoga_cloth.png")
require(tidyverse)
24/60
require(leaflet)
tibble(lon = c(35.4),
lat= c(-3.5),
pics = c("../images/datoga.png")) %>%
leaflet() %>%
addTiles() %>%
addCircleMarkers(
fillOpacity = 0.8, radius = 5,
lng = ~lon, lat =~lat,
popup = popupImage(pics)
)
library(mapview)
tibble(lon = c(35.4),
lat= c(-3.5),
pics = c("../images/datoga.png")) %>%
leaflet() %>%
addTiles() %>%
addCircleMarkers(
fillOpacity = 0.8, radius = 5,
lng = ~lon, lat =~lat,
popup = popupImage(pics)
)
population
require(sf)
tibble(lon = c(35.4),
lat= c(-3.5),
pics = c("../images/datoga.png")) %>%
leaflet() %>%
addTiles() %>%
addCircleMarkers(
fillOpacity = 0.8, radius = 5,
lng = ~lon, lat =~lat,
popup = popupImage(pics)
)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, comment = "")
require(tidyverse)
require(leaflet)
library(mapview)
require(sf)
tibble(lon = c(35.4),
lat= c(-3.5),
pics = c("../images/datoga.png")) %>%
leaflet() %>%
addTiles() %>%
addCircleMarkers(
fillOpacity = 0.8, radius = 5,
lng = ~lon, lat =~lat,
popup = popupImage(pics)
)
tibble(lon = c(35.4),
lat= c(-3.5),
pics = c("../images/datoga.png")) %>%
leaflet() %>%
addTiles() %>%
addCircleMarkers(
fillOpacity = 0.8, radius = 5,
lng = ~lon, lat =~lat
)
blogdown::serve_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown:::new_post_addin()
blogdown::serve_site()
